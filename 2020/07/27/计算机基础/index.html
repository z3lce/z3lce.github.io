<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>计算机基础 | z3lce学习记录</title><meta name="description" content="80368模式  寻址方式 有实模式和保护模式，即和64位的寻址方式比较相似，可以类比。 实模式是与8086就是几乎一模一样的，所以不再介绍。  全局描述符表寄存器GDTR ( Global Descriptor Table Register ) , 是48位寄存器，用来保存全局描述符表( GDT )的32位基地址和GDT的大小( 16位)。◆中断描述符表寄存器IDTR ( Interrupt"><meta name="keywords" content="basic,PE"><meta name="author" content="z3lce"><meta name="copyright" content="z3lce"><meta name="format-detection" content="telephone=no"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="http://www.infore.top/2020/07/27/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//fonts.googleapis.com" crossorigin="crossorigin"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta name="360-site-verification" content="{&quot;theme_color&quot;:{&quot;enable&quot;:true,&quot;main&quot;:&quot;#49B1F5&quot;,&quot;paginator&quot;:&quot;#00c4b6&quot;,&quot;button_hover&quot;:&quot;#FF7242&quot;,&quot;text_selection&quot;:&quot;#00c4b6&quot;,&quot;link_color&quot;:&quot;#99a9bf&quot;,&quot;meta_color&quot;:&quot;#858585&quot;,&quot;hr_color&quot;:&quot;#A4D8FA&quot;,&quot;code_foreground&quot;:&quot;#F47466&quot;,&quot;code_background&quot;:&quot;rgba(27, 31, 35, .05)&quot;,&quot;toc_color&quot;:&quot;#00c4b6&quot;,&quot;blockquote_padding_color&quot;:&quot;#49b1f5&quot;,&quot;blockquote_background_color&quot;:&quot;#49b1f5&quot;}}"/><meta property="og:type" content="article"><meta property="og:title" content="计算机基础"><meta property="og:url" content="http://www.infore.top/2020/07/27/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/"><meta property="og:site_name" content="z3lce学习记录"><meta property="og:description" content="80368模式  寻址方式 有实模式和保护模式，即和64位的寻址方式比较相似，可以类比。 实模式是与8086就是几乎一模一样的，所以不再介绍。  全局描述符表寄存器GDTR ( Global Descriptor Table Register ) , 是48位寄存器，用来保存全局描述符表( GDT )的32位基地址和GDT的大小( 16位)。◆中断描述符表寄存器IDTR ( Interrupt"><meta property="og:image" content="https://pdc246871-1302651496.cos.ap-nanjing.myqcloud.com/20200719093150.png"><meta property="article:published_time" content="2020-07-27T15:32:26.000Z"><meta property="article:modified_time" content="2020-07-27T15:32:26.000Z"><meta name="twitter:card" content="summary"><script>var activateDarkMode = function () {
  document.documentElement.setAttribute('data-theme', 'dark')
  if (document.querySelector('meta[name="theme-color"]') !== null) {
    document.querySelector('meta[name="theme-color"]').setAttribute('content', '#000')
  }
}
var activateLightMode = function () {
  document.documentElement.setAttribute('data-theme', 'light')
  if (document.querySelector('meta[name="theme-color"]') !== null) {
    document.querySelector('meta[name="theme-color"]').setAttribute('content', '#fff')
  }
}

var getCookies = function (name) {
  const value = `; ${document.cookie}`
  const parts = value.split(`; ${name}=`)
  if (parts.length === 2) return parts.pop().split(';').shift()
}

var autoChangeMode = 'false'
var t = getCookies('theme')
if (autoChangeMode === '1') {
  var isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
  var isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
  var isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
  var hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

  if (t === undefined) {
    if (isLightMode) activateLightMode()
    else if (isDarkMode) activateDarkMode()
    else if (isNotSpecified || hasNoSupport) {
      console.log('You specified no preference for a color scheme or your browser does not support it. I Schedule dark mode during night time.')
      var now = new Date()
      var hour = now.getHours()
      var isNight = hour <= 6 || hour >= 18
      isNight ? activateDarkMode() : activateLightMode()
    }
    window.matchMedia('(prefers-color-scheme: dark)').addListener(function (e) {
      if (Cookies.get('theme') === undefined) {
        e.matches ? activateDarkMode() : activateLightMode()
      }
    })
  } else if (t === 'light') activateLightMode()
  else activateDarkMode()
} else if (autoChangeMode === '2') {
  now = new Date()
  hour = now.getHours()
  isNight = hour <= 6 || hour >= 18
  if (t === undefined) isNight ? activateDarkMode() : activateLightMode()
  else if (t === 'light') activateLightMode()
  else activateDarkMode()
} else {
  if (t === 'dark') activateDarkMode()
  else if (t === 'light') activateLightMode()
}</script><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css"><link rel="prev" title="SMC介绍" href="http://www.infore.top/2020/09/11/SMC%E4%BB%8B%E7%BB%8D/"><link rel="next" title="逆向基础知识" href="http://www.infore.top/2020/07/27/%E9%80%86%E5%90%91%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web&amp;display=swap"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容:${query}"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  bookmark: {
    message_prev: '按',
    message_next: '键将本页加入书签'
  },
  runtime_unit: '天',
  runtime: true,
  copyright: {"languages":{"author":"作者: z3lce","link":"链接: ","source":"来源: z3lce学习记录","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  ClickShowText: undefined,
  medium_zoom: false,
  fancybox: true,
  Snackbar: {"bookmark":{"message_prev":"按","message_next":"键将本页加入书签"},"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#49b1f5","bgDark":"#121212","position":"bottom-left"},
  justifiedGallery: {
    js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
    css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
  },
  baiduPush: false,
  highlightCopy: true,
  highlightLang: true,
  isPhotoFigcaption: false,
  islazyload: true,
  isanchor: false    
}</script><script>var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isSidebar: true
  }</script><noscript><style>
#nav {
  opacity: 1
}
.justified-gallery img{
  opacity: 1
}
</style></noscript><link rel="stylesheet" href="/css/background.css"><meta name="generator" content="Hexo 4.2.1"></head><body><script type="text/javascript" src="/js/crash_cheat.js"></script><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">加载中...</div></div></div><canvas class="fireworks"></canvas><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="avatar-img" src="/img/avatar.gif" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="mobile_post_data"><div class="mobile_data_item is-center"><div class="mobile_data_link"><a href="/archives/"><div class="headline">文章</div><div class="length_num">14</div></a></div></div><div class="mobile_data_item is-center">      <div class="mobile_data_link"><a href="/tags/"><div class="headline">标签</div><div class="length_num">12</div></a></div></div><div class="mobile_data_item is-center">     <div class="mobile_data_link"><a href="/categories/"><div class="headline">分类</div><div class="length_num">10</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于我</span></a></div></div></div></div><i class="fas fa-arrow-right on" id="toggle-sidebar"></i><div id="sidebar"><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar">     </div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#80368模式"><span class="toc-number">1.</span> <span class="toc-text"> 80368模式</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#寻址方式"><span class="toc-number">1.1.</span> <span class="toc-text"> 寻址方式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#传送指令"><span class="toc-number">1.2.</span> <span class="toc-text"> 传送指令</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#算术运算指令"><span class="toc-number">1.3.</span> <span class="toc-text"> 算术运算指令</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#逻辑运算控制转移指令"><span class="toc-number">1.4.</span> <span class="toc-text"> 逻辑运算&amp;控制转移指令</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#串操作处理器控制指令"><span class="toc-number">1.5.</span> <span class="toc-text"> 串操作&amp;处理器控制指令</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#二进制分析pwn"><span class="toc-number">2.</span> <span class="toc-text"> 二进制分析&amp;pwn</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#编译"><span class="toc-number">2.1.</span> <span class="toc-text"> 编译</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#调试"><span class="toc-number">2.2.</span> <span class="toc-text"> 调试</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#检查保护"><span class="toc-number">2.2.1.</span> <span class="toc-text"> 检查保护</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#查找system函数的plt地址"><span class="toc-number">2.2.2.</span> <span class="toc-text"> 查找system函数的plt地址</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#查找bin_sh字符串地址"><span class="toc-number">2.2.3.</span> <span class="toc-text"> 查找bin_sh字符串地址</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#栈溢出shellcode编写"><span class="toc-number">2.2.4.</span> <span class="toc-text"> 栈溢出（shellcode编写）</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#pe文件结构讲解与特征码免杀原理"><span class="toc-number">2.3.</span> <span class="toc-text"> PE文件结构讲解与特征码免杀原理</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#pe结构"><span class="toc-number">2.3.0.0.1.</span> <span class="toc-text"> PE结构</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#pe文件与内存映像"><span class="toc-number">2.3.0.0.2.</span> <span class="toc-text"> PE文件与内存映像</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#dos头分header和dos存根header结构00000000-0000003f共64个字节-mz"><span class="toc-number">2.3.0.0.3.</span> <span class="toc-text"> DOS头（分Header和DOS存根）：Header结构(00000000 - 0000003F，共64个字节)   MZ</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#nt头pe最重要的头长度由dos头-e_lfanew-决定image_nt_headers32pe"><span class="toc-number">2.3.0.0.4.</span> <span class="toc-text"> NT头（PE最重要的头，长度由DOS头 e_lfanew 决定）：IMAGE_NT_HEADERS32PE</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#dos存根00000040-000000bf共128字节"><span class="toc-number">2.3.0.0.5.</span> <span class="toc-text"> DOS存根（00000040 - 000000BF，共128字节）</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#特征码免杀"><span class="toc-number">2.3.0.0.6.</span> <span class="toc-text"> 特征码免杀</span></a></li></ol></li></ol></li></ol></li></ol></li></ol></div></div></div><div id="body-wrap"><div id="web_bg" data-type="color"></div><header class="post-bg" id="page-header" style="background-image: url(https://pdc246871-1302651496.cos.ap-nanjing.myqcloud.com/20200719093150.png)"><nav id="nav"><span class="pull-left" id="blog_name"><a class="blog_title" id="site-name" href="/">z3lce学习记录</a></span><span class="pull-right menus"><div id="search_button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于我</span></a></div></div><span class="toggle-menu close"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></span></span></nav><div id="post-info"><div id="post-title"><div class="posttitle">计算机基础</div></div><div id="post-meta"><div class="meta-firstline"><time class="post-meta__date"><span class="post-meta__date-created" title="发表于 2020-07-27 23:32:26"><i class="far fa-calendar-alt fa-fw"></i> 发表于 2020-07-27</span><span class="post-meta__separator">|</span><span class="post-meta__date-updated" title="更新于 2020-07-27 23:32:26"><i class="fas fa-history fa-fw"></i> 更新于 2020-07-27</span></time><span class="post-meta__categories"><span class="post-meta__separator">|</span><i class="fas fa-inbox fa-fw post-meta__icon"></i><a class="post-meta__categories" href="/categories/pwn/">pwn</a><i class="fas fa-angle-right post-meta__separator"></i><i class="fas fa-inbox fa-fw post-meta__icon"></i><a class="post-meta__categories" href="/categories/PE/">PE</a><i class="fas fa-angle-right post-meta__separator"></i><i class="fas fa-inbox fa-fw post-meta__icon"></i><a class="post-meta__categories" href="/categories/computer/">computer</a></span></div><div class="meta-secondline"> <span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta__icon"></i><span>字数总计:</span><span class="word-count">6.3k</span><span class="post-meta__separator">|</span><i class="far fa-clock fa-fw post-meta__icon"></i><span>阅读时长: 22 分钟</span></span></div><div class="meta-thirdline"><span class="post-meta-pv-cv"><span class="post-meta__separator">|</span><i class="far fa-eye fa-fw post-meta__icon"></i><span>阅读量:</span><span id="busuanzi_value_page_pv"></span></span><span class="post-meta-commentcount"></span></div></div></div></header><main class="layout_post" id="content-inner"><article id="post"><div class="post-content" id="article-container"><h1 id="80368模式"><a class="markdownIt-Anchor" href="#80368模式"></a> 80368模式</h1>
<h2 id="寻址方式"><a class="markdownIt-Anchor" href="#寻址方式"></a> 寻址方式</h2>
<p>有实模式和保护模式，即和64位的寻址方式比较相似，可以类比。</p>
<p>实模式是与8086就是几乎一模一样的，所以不再介绍。</p>
<p><img src= "/img/loading.gif" data-src="https://pdc246871-1302651496.cos.ap-nanjing.myqcloud.com/image-20200412175657373.png" alt="" /></p>
<p>全局描述符表寄存器GDTR ( Global Descriptor Table Register ) , 是48位寄存器，用来保存全局描述符表( GDT )的32位基地址和GDT的大小( 16位)。◆中断描述符表寄存器IDTR ( Interrupt Descriptor Table Register) , 是48位寄存器,用来保存中断描述符表( IDT )的32位基地址和IDT的大小(16位)。局部描述符表寄存器LDTR ( Local Descriptor Table Register ) , 是16位寄存器,保存局部描述符表LDT段的选择符。任务状态寄存器TR ( Task State Register )是16位寄存器，用于保存任务状态段TSS段的16位选择符。</p>
<p><img src= "/img/loading.gif" data-src="https://pdc246871-1302651496.cos.ap-nanjing.myqcloud.com/image-20200412175821437.png" alt="image-20200412175821437" /></p>
<p>保护模式是根据cs区分，16位二进制区分；通过ti值区分是否通过局部描述符表寄存器LDTR两个分别指向全局描述符表GDT和局部描述符表LDT；通过段寄存器来提供索引从段选择表中选择接收到的索引来找到相应的段描述符。</p>
<p><img src= "/img/loading.gif" data-src="https://pdc246871-1302651496.cos.ap-nanjing.myqcloud.com/image-20200412203452617.png" alt="image-20200412203452617" /></p>
<p>标志寄存器的第17位为vm表示是不是保护模式</p>
<p><img src= "/img/loading.gif" data-src="https://pdc246871-1302651496.cos.ap-nanjing.myqcloud.com/image-20200412203819032.png" alt="image-20200412203819032" /></p>
<h2 id="传送指令"><a class="markdownIt-Anchor" href="#传送指令"></a> 传送指令</h2>
<p>movsx dst,src 有符号</p>
<p>movzx dst,src 无符号</p>
<p>bswap reg 将32位寄存器中，第一个字节和第4个字节交换，第二个字节和第三个字节交换</p>
<p>pusha 将16位通用寄存器压入堆栈，压栈顺序：AX,CX,DX,BX,SP,BP,SI,DI</p>
<p>PUSHAD 将32位通用寄存器压入堆栈，压栈顺序EAX,ECX,EDX,EBX,ESP,EBP,ESI,EDI</p>
<p>POPA 和popad 分别移出16字节、32字节并按相反压栈顺序存入寄存器</p>
<p>lahf将标志寄存器中低8位送入ah，sahf将ah中内容送标志寄存器中低8位</p>
<p>PUSHF将标志寄存器低16位内容压入堆栈, SP←SP-2。 POPF将当前栈顶一个字传送到标志寄存器低16位中, SP←-SP+2.</p>
<p>PUSHFD将标志寄存器32位内容压入堆栈SP←SP-4。POPFD将当前栈顶一个双字传送到32位标志寄存器中，SP←SP+4。</p>
<p>mov、pop、push系列都不影响标志位</p>
<h2 id="算术运算指令"><a class="markdownIt-Anchor" href="#算术运算指令"></a> 算术运算指令</h2>
<p>功能: ADD是将源操作数与目的操作数相加,结果传送到目的操作数。ADC是将源操作数与目的操作数以及CF(低位进位)值相加,结果传送到目的操作数。</p>
<p>源操作数可以是通用寄存器、存储器或立即数。目的操作数可以是通用寄存器或存储器操作数。</p>
<p>ADD , ADC指令影响标志位为OF , SF , ZF , AF, PF , CF.</p>
<p>MOV AX,9876H</p>
<p>ADD AH, AL; AX=0E76H CF=1 SF=0OF=0 ZF=0 AF=0 PF=0</p>
<p>ADC AH , AL ; AX=8576H CF=0 SF=1OF=1 ZF=0 AF=1 PF=0</p>
<p>功能: SUB将目的操作数减源操作数,结果送目的操作数。SBB将 目的操作数减源操作数,还要减CF(低位借位)值,结果送目的操作数。</p>
<p>源操作数可以是通用寄存器、存储器或立即数。目的操作数可以是通用寄存器或存储器操作数。</p>
<p>SUB , SBB指令影响标志位为OF , SF , ZF, AF, PF , CF。</p>
<p>MOV AX，9966H ; AX=9966H</p>
<p>SUB AL, 80H;AL=E6H CF=1SF=1 OF=1 ZF=0 AF=0 PF=0</p>
<p>SBB AH, 80H;AH=18H CF=0SF=0 OF=0 ZF=0 AF=0 PF=1</p>
<p>inc dst 加一 dec dst 减一</p>
<p>INC指令将目的操作数加1 , 结果送目的操作数。DEC指令将目的操作数减1 , 结果送目的操作数。目的操作数为通用寄存器或存储器操作数。INC , DEC指令影响标志位为OF , SF , ZF, AF , PF.</p>
<p>功能:目的操作数减源操作数,结果不回送。源操作数为通用寄存器、存储器和立即数。目的操作数为通用寄存器、存储器操作数。CMP指令影响标志位为OF , SF , ZF , AF, PF , CF。</p>
<p><img src= "/img/loading.gif" data-src="https://pdc246871-1302651496.cos.ap-nanjing.myqcloud.com/image-20200412214841009.png" alt="image-20200412214841009" /></p>
<p>格式: XADD DEST , REG</p>
<p>功能:目的操作数加源操作数,结果送目的操作数。原目的操作数内容送源操作数。源操作数允许为通用寄存器。目的操作数允许为通用寄存器、存储器操作数。</p>
<p>格式: XADD DEST , REG<br />
功能:目的操作数加源操作数,结果送目的操作数。原目的操作数内容送源操作数。源操作数允许为通用寄存器。目的操作数允许为通用寄存器、<br />
存储器操作数。<br />
XADD指令影响标志位为OF , SF , ZF , AF, PF , CF.</p>
<p>NEG DEST</p>
<p>功能:对目的操作数求补,用零减去目的操作数,结果送目的操作数。目的操作数为通用寄存器、存储器操作数。</p>
<p>NEG指令影响标志位为OF,SF,ZF,AF,PF,CF。</p>
<p>功能: MUL为无符号数乘法指令, IMUL为带符号数乘法指令。源操作数为通用寄存器或存储器操作数。目的操作数缺省存放在ACC(AL, AX, EAX)中,乘积存AX, DX: AX, EDX : EAX中。</p>
<p>字节乘: AL SRC-→AX</p>
<p>字乘: AX SRC-→DX : AX</p>
<p>双字乘: EAX SRC-→EDX: EAX</p>
<p>MUL , IMUL指令执行后, CF=OF=0 ,表示乘积高位无有效数据; CF=OF= 1表示乘积高位含有效数据,对其它标志位无定义。</p>
<p>功能: DIV为无符号数除法, IDIV为带符号数除法。源操作数作为除数,为通用寄存器或存储器操作数。被除数缺省在目的操作数AX ,DX: AX, EDX: EAX中。</p>
<p>字节除法: AX/SRC商→AL,余数-→AH</p>
<p>字除法: DX-AX/SRC商-→AX ,余数→DX_</p>
<p>双字除法: EDX:EAX/SRC商-→EAX ,余数-→EDX</p>
<p>由于被除数必须是除数的双倍字长，-般应使用扩展指令进行高位扩展。当进行无符号数除法时,被除数高位按0扩展为双倍除数字长。当进行有符号数除法时,被除数以补码表示。可使用扩展指令CBW , CWD , CWDE , CDQ进行高位打展。</p>
<p>对于带符号除法,其商和余数均采用补码形式表示,余数与被除数同符号。当除数为零或商超过了规定数据类型所能表示的范围时, 将会出现溢出现象,产生一个中断类型码为&quot;0&quot; 的中断。执行除法指令后标志位无定义。</p>
<h2 id="逻辑运算控制转移指令"><a class="markdownIt-Anchor" href="#逻辑运算控制转移指令"></a> 逻辑运算&amp;控制转移指令</h2>
<p>and dst,src</p>
<p>功能:目的操作数和源操作数按位进行逻辑与运算,结果存目的操作数中。源操作数可以是通用寄存器、存储器或立即数。目的操作数可以是通用寄存器或存储器操作数。</p>
<p>or dst,src 位为1结果置1，都为0才置零</p>
<p>xor dst,src 异或，即不相同为1</p>
<p>not dst,src取反</p>
<p>test dst,src</p>
<p>功能:目的操作数和源操作数按位进行逻辑与操作,结果不回送目的操作数。源操作数可以为通用寄存器、存储器或立即数。目的操作数可以为通功能:目的操作数和源操作数按位进行逻辑与操作,结果不回送目的操作数。源操作数可以为通用寄存器、存储器或立即数。目的操作数可以为通用寄存器或存储器操作数。</p>
<p>TEST指令常用于测试操作数中某位是否为1 r而且不会影响目的操作数。如果测试某位的状态,对某位进行逻辑与1的运算,其它位逻辑与0 ,然后判断标志位。运算结果为0 , ZF=1 ,表示被测试位为0 ;否则ZF=0 ,表示被测试位为1.</p>
<p>算术/逻辑左移指令<br />
格式: SAL DEST , OPRD<br />
SHL DEST , OPRD<br />
功能:按照操作数OPRD规定的移位位数,对目的操作数进行左移操作,最高位移入CF中。每移动- -位,右边补一位0。目的操作数可以<br />
用寄存器或存储器操作数。<br />
SAL , SHL指令影响标志位OF, SF , ZF, PF, CF。</p>
<h2 id="串操作处理器控制指令"><a class="markdownIt-Anchor" href="#串操作处理器控制指令"></a> 串操作&amp;处理器控制指令</h2>
<p>串操作通常以DS : (E)SI来寻址源串,以ES : (E)DI来寻址目的串,对于源串允许段超越。(E)SI或(E)Dl这两个地址指针在每次串操作后,都自动进行修改,以指向串中下一个串元素。地址指针修改是增量还是减量由方向标志来规定。当DF=0 , (E)SI及(E)DI的修改为增量;当DF= 1 , (E)SI及(E)DI的修改为减量。根据串元素类型不同,地址指针增减量也不同,在串操作时,字节类型SI , DI咖、减1 ;字类型SI , DI加、减2;双字类型ESI ,EDI加、减4。如果需要连续进行串操作,通常加重复前缀。重复前缀可以和任何串操作指令组合,形成复合指令</p>
<p><img src= "/img/loading.gif" data-src="https://pdc246871-1302651496.cos.ap-nanjing.myqcloud.com/image-20200413204522332.png" alt="image-20200413204522332" /></p>
<p>movs ，movsw,movsb,movsd 串传送指令</p>
<p><img src= "/img/loading.gif" data-src="https://pdc246871-1302651496.cos.ap-nanjing.myqcloud.com/image-20200413224834574.png" alt="image-20200413224834574" /></p>
<p>串比较指令<br />
基本格式: [REPE/Z] [REPNZ/NE] CMPS DESTS, SRCS<br />
[REPE/Z] [REPNZ/NE] CMPSB/CMPSW/CMPSD<br />
功能:由DS : (E)SI规定的源串元素减去ES : (E)DI指出的目的串元素,结果不回送,仅影响标志位CF , AF，PF, OF , ZF , SF.当源串元素与目的串元素值相同时, ZF=1 ;否则ZF=0。每执行一次串比较指令，根据DF的值和串元素数据类型自动修改(E)SI和(E)DI。<br />
在串比较指令前加重复前缀REPE/Z ,则表示重复比较两个字符串,若两个字符串的元素相同则此较到(E)CX=0为止,否则结束比较。在串比较指令前加重复前REPNE/NZ ,则表示若两个字符串元素不相同时,重复比较直到(E)CX=0为止,否则结束比较</p>
<p>串扫描指令<br />
格式①: [REPE/Z] [REPNE/NZ] SCAS DESTS<br />
格式②: [REPE/Z] [REPNE/NZ] SCASB/SCASW/SCASD<br />
功能:由AL , AX或EAX的内容减去ES : (E)DI规定的目的串元素,结果不回送,仅影响标志位CF , AF,PF, SF ,OF , ZF。当AL, AX或EAX的值与目的串元素值相同时, ZF=1 ;否则ZF=0。每执行- -次串扫描指令,根据DF的值和串元素数据类型自动修改(E)DI。<br />
在串扫描指令前加重复前缀REPE/Z ,则表示目的串元素值和累加器值相同时重复扫描,直到CX/ECX=0为止,否则结束3描。若加重复前缀REPNE/NZ ,则表示当目的串元素值与累加器值不相等时,重复扫描直到CX/ECX=0时为止,否则结束扫描。该指令影响标志位为CF , AF, PF , SF , OF , ZF。</p>
<p>串存储指令<br />
格式: [REP] STOS DESTS<br />
[REP] STOSB/STOSW/STOSD<br />
功能:将累加器[AL, AX , EAX]中值存入ES : DI/EDI所指的目的串存储单元中,每传递一次,都按DF值以及串元素类型自动修改地址指针DI/EDI。若加重复前缀REP ,则表示将累加器的值连续送目的串存储单元,直到CX/ECX=0时为止。<br />
该指令不影响标志位。</p>
<p>中断指令与DOS功能调用<br />
中断指令格式: INT n<br />
功能:产生中断类型码为n的软中断,该指令包含中断操作码和中断类型码两部分,中断类型码n为8位,取值范围为0.255(00H FFH)<br />
软中断执行过程:<br />
①将标志寄存器FLAGS(或EFLAGS)压入堆栈;<br />
⑦清除TF和IF标志位;<br />
③CS, IP/EIP压入堆栈;<br />
④实模式下, nx4获取中断欠量表地址指针:保护模式下, nx 8获取中断描述符表地址指针:<br />
⑤根据地址指针。从中断矢量表或中断描述符表中取出中断服务程序地址送IP/EIP和CS中,控制程序转移去执行中断服务程序。</p>
<p>中断返回指令格式: IRET/IRETD<br />
功能:该指令实现在中断服务程序结束后,返回到主程序中断断点处,继续执行主程序。<br />
中断返回执行过程:<br />
IRET指令弹出堆栈中数据送IP , CS , FLAGS;<br />
IRETD指令弹出堆栈中数据送EIP，CS，EFLAGS。</p>
<h1 id="二进制分析pwn"><a class="markdownIt-Anchor" href="#二进制分析pwn"></a> 二进制分析&amp;pwn</h1>
<h2 id="编译"><a class="markdownIt-Anchor" href="#编译"></a> 编译</h2>
<p>gcc -no-pie -m32 -o xx xx.c</p>
<h2 id="调试"><a class="markdownIt-Anchor" href="#调试"></a> 调试</h2>
<h3 id="检查保护"><a class="markdownIt-Anchor" href="#检查保护"></a> 检查保护</h3>
<p>checksek</p>
<h3 id="查找system函数的plt地址"><a class="markdownIt-Anchor" href="#查找system函数的plt地址"></a> 查找system函数的plt地址</h3>
<p>objdump -d -j .plt ./xx |grep system</p>
<h3 id="查找bin_sh字符串地址"><a class="markdownIt-Anchor" href="#查找bin_sh字符串地址"></a> 查找bin_sh字符串地址</h3>
<p>pip install ropgadget</p>
<p>ROPgadget --binary ./xx --string “/bin/sh”</p>
<h3 id="栈溢出shellcode编写"><a class="markdownIt-Anchor" href="#栈溢出shellcode编写"></a> 栈溢出（shellcode编写）</h3>
<p>写入数据不捡查长度，容易导致数据的溢出；而进行的写入数据的执行；往栈里写入数据会导致溢出，溢出方式会向下覆盖栈，要注意堆栈平衡。</p>
<h2 id="pe文件结构讲解与特征码免杀原理"><a class="markdownIt-Anchor" href="#pe文件结构讲解与特征码免杀原理"></a> PE文件结构讲解与特征码免杀原理</h2>
<p><img src= "/img/loading.gif" data-src="https://pdc246871-1302651496.cos.ap-nanjing.myqcloud.com/image-20200420212023529.png" alt="image-20200420212023529" /></p>
<p>PE（portable executable）基本结构：</p>
<p>PE文件是指32位可执行文件，也称为PE32。64位的可执行文件称为PE+或PE32+,是PE(PE32)的一种扩展形式（请注意不是PE64)。</p>
<p>Magic :表示可选头的类型。<br />
MajorL inkerVersion和MinorL inkerVersion :链接器的版本号。<br />
SizeOfCode :代码段的长度,如果有多个代码段,则是代码段长度的总和。<br />
SizeOfInitializedData :初始化的数据长度。<br />
SizeOfUninitializedData :未初始化的数据长度。<br />
AddressOfEntryPoint :程序入口的RVA ,对于exe这个地址可以理解为WinMain的RVA.<br />
对于DLL ,这个地址可以理解为DlIMain的RVA，<br />
如果是驱动程序,可以理解为DriverEntry的RVA。<br />
BaseOfC ode :代码段起始地址的RVA。<br />
BaseOfData :数据段起始地址的RVA。<br />
ImageBase :映象(加载到内存中的PE文件)的基地址,这个基地址是建议,对于DLL来说,如果无法加载到这个地址,系统会自动为其选择地址。<br />
SectionAlignment :节对齐, PE中的节被加载到内存时会按照这个域指定的值来对齐,比如这个值是0x1000 ,那么每个节的起始地址的低12位都为0.<br />
FileAlignment :节在文件中按此值对齐, SectionAlignment必须大于或等于FileAlignment.<br />
MajorOperatingSystemVersion. MinorOperatingSystemVersion :所需操作系统的版本号,随着操作系统版本越来越多,这个好像不是那么重要了。<br />
MajorImageVersion, MinorlmageVersion :映象的版本号,这个是开发者自己指定的,由连接器填写。<br />
MajorSubsystemVersion. MinorSubsystemVersion :所需子系统版本号。<br />
Win32VersionValue ;保留，必须为0.<br />
SizeOfImage :映象的大小, PE文件加载到内存中空间是连续的,这个值指定占用虚拟空间的大小。<br />
SizeOfHeaders :所有文件头(包括节表)的大小,这个值是以FileAlignment对齐的。<br />
CheckSum :映象文件的校验和。<br />
Subsystem :运行该PE文件所需的子系统。</p>
<p>pe头结构：</p>
<p>SizeOfRawData :该区块在磁盘中所占的大小。在可执行文件中,该字段是已经被FileAlignment潜规则处理过的长度。<br />
PointerToRawData :该区块在磁盘中的偏移。这个数值是从文件头开始算起的偏移量。</p>
<p>Characteristics :该区块的属性。该字段是按位来指出区块的属性(如代码/数据/可读/可写等)的标志。</p>
<h5 id="pe结构"><a class="markdownIt-Anchor" href="#pe结构"></a> PE结构</h5>
<p>当一个PE文件被执行时，PE装载器首先检查DOS header里的PE header的偏移量。如果找到，则直接跳转到PE header的位置。</p>
<p>当PE装载器跳转到PE header后，第二步要做的就是检查PE header是否有效。如果该PE header有效，就跳转到PE header的尾部。</p>
<p>紧跟PE header尾部的是节表。PE装载器执行完第二步后开始读取节表中的节段信息，并采用文件映射（在执行一个PE文件的时候，Windows并不在一开始就将整个文件读入内存，而是采用与内存映射的机制，也就是说，Windows装载器在装载的时候仅仅建立好虚拟地址和PE文件之间的映射关系，只有真正执行到某个内存页中的指令或者访问某一页中的数据时，这个页面才会被从磁盘提交到物理内存，这种机制使文件装入的速度和文件大小没有太大的关系）的方法将这些节段映射到内存，同时附上节表里指定节段的读写属性。</p>
<p>PE文件映射入内存后，PE装载器将继续处理PE文件中类似 import table （输入表）的逻辑部分。</p>
<p>这四个步骤便是PE文件的执行顺序，具体细节读者可以参考相关文档。（以上四个步骤摘自《黑客破解精通》）</p>
<h5 id="pe文件与内存映像"><a class="markdownIt-Anchor" href="#pe文件与内存映像"></a> PE文件与内存映像</h5>
<p><img src= "/img/loading.gif" data-src="https://pdc246871-1302651496.cos.ap-nanjing.myqcloud.com/5423323-f4d307276ece24d7.png" alt="img" /></p>
<p>文件中使用偏移（offset），内存中使用VA（Virtual Address，虚拟地址）来表示位置。</p>
<p>VA指进程虚拟内存的绝对地址，RVA(Relative Virtual Address，相对虚拟地址)是指从某基准位置（ImageBase）开始的相对地址。VA与RVA满足下面的换算关系：</p>
<p>RVA+ImageBase=VA</p>
<p>PE头内部信息大多是RVA形式存在。原因在于（主要是DLL）加载到进程虚拟内存的特定位置时，该位置可能已经加载了其他的PE文件（DLL）。此时必须通过重定向（Relocation）将其加载到其他空白的位置，若PE头信息使用的是VA，则无法正常访问。因此使用RVA来重定向信息，即使发生了重定向，只要相对于基准位置的相对位置没有变化，就能正常访问到指定信息，不会出现任何问题。</p>
<p>当PE文件被执行时，PE装载器会为进程分配4GB的虚拟地址空间，然后把程序所占用的磁盘空间作为虚拟内存映射到这个4GB的虚拟地址空间中。一般情况下，会映射到虚拟地址空间中的0X400000的位置。</p>
<h5 id="dos头分header和dos存根header结构00000000-0000003f共64个字节-mz"><a class="markdownIt-Anchor" href="#dos头分header和dos存根header结构00000000-0000003f共64个字节-mz"></a> DOS头（分Header和DOS存根）：Header结构(00000000 - 0000003F，共64个字节)   MZ</h5>
<figure class="highlight rust"><table><tr><td class="code"><pre><code class="hljs rust">typedef <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">_IMAGE_DOS_HEADER</span></span> &#123; <span class="hljs-comment">// DOS的.EXE头部</span><br>  USHORT e_magic;  '<span class="hljs-comment">// DOS签名“MZ--&gt;Mark Zbikowski（设计了DOS的工程师）” -&gt; 4D 5A '</span><br>  USHORT e_cblp;    <span class="hljs-comment">// 文件最后页的字节数 -&gt; 00 90 -&gt; 144</span><br>  USHORT e_cp;      <span class="hljs-comment">// 文件页数 -&gt; 00 30 -&gt; 48</span><br>  USHORT e_crlc;    <span class="hljs-comment">// 重定义元素个数 -&gt; 00 00</span><br>  USHORT e_cparhdr; <span class="hljs-comment">// 头部尺寸，以段落为单位 -&gt; 00 04</span><br>  USHORT e_minalloc; <span class="hljs-comment">// 所需的最小附加段 -&gt; 00 00</span><br>  USHORT e_maxalloc; <span class="hljs-comment">// 所需的最大附加段 -&gt; FF FF</span><br>  USHORT e_ss;       <span class="hljs-comment">// 初始的SS值（相对偏移量） -&gt; 00 00</span><br>  USHORT e_sp;       <span class="hljs-comment">// 初始的SP值 -&gt; 00 B8 -&gt; 184</span><br>  USHORT e_csum;     <span class="hljs-comment">// 校验和 -&gt; 00 00</span><br>  USHORT e_ip;       <span class="hljs-comment">// 初始的IP值 -&gt; 00 00</span><br>  USHORT e_cs;       <span class="hljs-comment">// 初始的CS值（相对偏移量） -&gt; 00 00</span><br>  USHORT e_lfarlc;   <span class="hljs-comment">// 重分配表文件地址 -&gt; 00 40 -&gt; 64</span><br>  USHORT e_ovno;     <span class="hljs-comment">// 覆盖号 -&gt; 00 00</span><br>  USHORT e_res[<span class="hljs-number">4</span>];   <span class="hljs-comment">// 保留字 -&gt; 00 00 00 00 00 00 00 00</span><br>  USHORT e_oemid;    <span class="hljs-comment">// OEM标识符（相对e_oeminfo） -&gt; 00 00</span><br>  USHORT e_oeminfo;  <span class="hljs-comment">// OEM信息 -&gt; 00 00</span><br>  USHORT e_res2[<span class="hljs-number">10</span>]; <span class="hljs-comment">// 保留字 -&gt; 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 </span><br>  LONG e_lfanew;    '<span class="hljs-comment">// 指示NT头的偏移（根据不同文件拥有可变值） -&gt; 00 00 00 C0 -&gt; 192'</span><br>&#125; IMAGE_DOS_HEADER, *PIMAGE_DOS_HEADER;<br></code></pre></td></tr></table></figure>
<p>注意Win+Intel的电脑上大部分采用”小端法”，字节在内存中储存方式是倒过来的。重要参数为<code>e_magic</code>和<code>e_lfanew</code>，已用不同颜色体现。</p>
<h5 id="nt头pe最重要的头长度由dos头-e_lfanew-决定image_nt_headers32pe"><a class="markdownIt-Anchor" href="#nt头pe最重要的头长度由dos头-e_lfanew-决定image_nt_headers32pe"></a> NT头（PE最重要的头，长度由DOS头 <code>e_lfanew</code> 决定）：<strong>IMAGE_NT_HEADERS32</strong>PE</h5>
<figure class="highlight cpp"><table><tr><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> _<span class="hljs-title">IMAGE_NT_HEADERS</span> &#123;</span> <br>        DWORD Signature;                         <span class="hljs-comment">// 类似于DOS头中的e_magic -&gt; 00 00 45 50 -&gt; PE</span><br>        IMAGE_FILE_HEADER FileHeader;             <span class="hljs-comment">// IMAGE_FILE_HEADER是PE文件头，定义如下</span><br>        IMAGE_OPTIONAL_HEADER32 OptionalHeader;   <span class="hljs-comment">// </span><br>&#125; IMAGE_NT_HEADERS32, *PIMAGE_NT_HEADERS32;<br>IMAGE_FILE_HEADER：其中有<span class="hljs-number">4</span>个重要的成员，若设置不正确，将会导致文件无法正常运行<br></code></pre></td></tr></table></figure>
<figure class="highlight rust"><table><tr><td class="code"><pre><code class="hljs rust">typedef <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">_IMAGE_FILE_HEADER</span></span> &#123; <br>        WORD    Machine;              '<span class="hljs-comment">// 每个CPU拥有唯一的Machine码 -&gt; 4C 01 -&gt; PE -&gt; 兼容32位Intel X86芯片'</span><br><br>        WORD    NumberOfSections;     '<span class="hljs-comment">// 指文件中存在的节段（又称节区）数量，也就是节表中的项数 -&gt; 00 04 -&gt; 4</span><br>                                       <span class="hljs-comment">// 该值一定要大于0，且当定义的节段数与实际不符时，将发生运行错误。'</span><br><br>        DWORD   TimeDateStamp;         <span class="hljs-comment">// PE文件的创建时间，一般有连接器填写 -&gt; 38 D1 29 1E</span><br>        DWORD   PointerToSymbolTable;  <span class="hljs-comment">// COFF文件符号表在文件中的偏移 -&gt; 00 00 00 00</span><br>        DWORD   NumberOfSymbols;       <span class="hljs-comment">// 符号表的数量 -&gt; 00 00 00 00</span><br><br>        WORD    SizeOfOptionalHeader; '<span class="hljs-comment">// 指出IMAGE_OPTIONAL_HEADER32结构体的长度。-&gt;  00 E0 -&gt; 224字节</span><br>                                       <span class="hljs-comment">// PE32+格式文件中使用的是IMAGE_OPTIONAL_HEADER64结构体，</span><br>                                       <span class="hljs-comment">// 这两个结构体尺寸是不相同的，所以需要在SizeOfOptionalHeader中指明大小。'</span><br><br>        WORD    Characteristics;      '<span class="hljs-comment">// 标识文件的属性，二进制中每一位代表不同属性 -&gt; 0F 01</span><br>                                       <span class="hljs-comment">// 属性参见https://blog.csdn.net/qiming_zhang/article/details/7309909#3.2.2'</span><br>&#125; IMAGE_FILE_HEADER, *PIMAGE_FILE_HEADER;<br><br>IMAGE_OPTIONAL_HEADER：其中有<span class="hljs-number">9</span>个重要参数，设置错误会导致文件无法运行<br></code></pre></td></tr></table></figure>
<figure class="highlight rust"><table><tr><td class="code"><pre><code class="hljs rust">typedef <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">_IMAGE_OPTIONAL_HEADER</span></span> &#123; <br>        WORD    Magic;                     '<span class="hljs-comment">// 魔数 32位为0x10B，64位为0x20B，ROM镜像为0x107'</span><br>        BYTE    MajorLinkerVersion;         <span class="hljs-comment">// 链接器的主版本号 -&gt; 05</span><br>        BYTE    MinorLinkerVersion;         <span class="hljs-comment">// 链接器的次版本号 -&gt; 0C</span><br>        DWORD   SizeOfCode;                 <span class="hljs-comment">// 代码节大小，一般放在“.text”节里，必须是FileAlignment的整数倍 -&gt; 40 00 04 00</span><br>        DWORD   SizeOfInitializedData;      <span class="hljs-comment">// 已初始化数大小，一般放在“.data”节里，必须是FileAlignment的整数倍 -&gt; 40 00 0A 00</span><br>        DWORD   SizeOfUninitializedData;    <span class="hljs-comment">// 未初始化数大小，一般放在“.bss”节里，必须是FileAlignment的整数倍 -&gt; 00 00 00 00</span><br>        DWORD   AddressOfEntryPoint;       '<span class="hljs-comment">// 指出程序最先执行的代码起始地址(RVA) -&gt; 00 00 10 00'</span><br>        DWORD   BaseOfCode;                 <span class="hljs-comment">// 代码基址，当镜像被加载进内存时代码节的开头RVA。必须是SectionAlignment的整数倍 -&gt; 40 00 10 00</span><br><br>        DWORD   BaseOfData;                 <span class="hljs-comment">// 数据基址，当镜像被加载进内存时数据节的开头RVA。必须是SectionAlignment的整数倍 -&gt; 40 00 20 00</span><br>                                            <span class="hljs-comment">// 在64位文件中此处被并入紧随其后的ImageBase中。</span><br><br>        DWORD   ImageBase;                 '<span class="hljs-comment">// 当加载进内存时，镜像的第1个字节的首选地址。</span><br>                                            <span class="hljs-comment">// WindowEXE默认ImageBase值为00400000，DLL文件的ImageBase值为10000000，也可以指定其他值。</span><br>                                            <span class="hljs-comment">// 执行PE文件时，PE装载器先创建进程，再将文件载入内存，</span><br>                                            <span class="hljs-comment">// 然后把EIP寄存器的值设置为ImageBase+AddressOfEntryPoint'</span><br><br>                                           '<span class="hljs-comment">// PE文件的Body部分被划分成若干节段，这些节段储存着不同类别的数据。'</span><br>        DWORD   SectionAlignment;          '<span class="hljs-comment">// SectionAlignment指定了节段在内存中的最小单位， -&gt; 00 00 10 00'</span><br>        DWORD   FileAlignment;             '<span class="hljs-comment">// FileAlignment指定了节段在磁盘文件中的最小单位，-&gt; 00 00 02 00</span><br>                                            <span class="hljs-comment">// SectionAlignment必须大于或者等于FileAlignment'</span><br><br>        WORD    MajorOperatingSystemVersion;<span class="hljs-comment">// 主系统的主版本号 -&gt; 00 04</span><br>        WORD    MinorOperatingSystemVersion;<span class="hljs-comment">// 主系统的次版本号 -&gt; 00 00</span><br>        WORD    MajorImageVersion;          <span class="hljs-comment">// 镜像的主版本号 -&gt; 00 00</span><br>        WORD    MinorImageVersion;          <span class="hljs-comment">// 镜像的次版本号 -&gt; 00 00</span><br>        WORD    MajorSubsystemVersion;      <span class="hljs-comment">// 子系统的主版本号 -&gt; 00 04</span><br>        WORD    MinorSubsystemVersion;      <span class="hljs-comment">// 子系统的次版本号 -&gt; 00 00</span><br>        DWORD   Win32VersionValue;          <span class="hljs-comment">// 保留，必须为0 -&gt; 00 00 00 00</span><br><br>        DWORD   SizeOfImage;               '<span class="hljs-comment">// 当镜像被加载进内存时的大小，包括所有的文件头。向上舍入为SectionAlignment的倍数。</span><br>                                            <span class="hljs-comment">// 一般文件大小与加载到内存中的大小是不同的。 -&gt; 00 00 50 00'</span><br><br>        DWORD   SizeOfHeaders;             '<span class="hljs-comment">// 所有头的总大小，向上舍入为FileAlignment的倍数。</span><br>                                            <span class="hljs-comment">// 可以以此值作为PE文件第一节的文件偏移量。-&gt; 00 00 04 00'</span><br><br>        DWORD   CheckSum;                   <span class="hljs-comment">// 镜像文件的校验和 -&gt; 00 00 B4 99</span><br><br>        WORD    Subsystem;                 '<span class="hljs-comment">// 运行此镜像所需的子系统 -&gt; 00 02 -&gt; 窗口应用程序</span><br>                                            <span class="hljs-comment">// 用来区分系统驱动文件（*.sys)与普通可执行文件（*.exe，*.dll），</span><br>                                            <span class="hljs-comment">// 参考：https://blog.csdn.net/qiming_zhang/article/details/7309909#3.2.3'</span><br><br>        WORD    DllCharacteristics;         <span class="hljs-comment">// DLL标识 -&gt; 00 00</span><br>        DWORD   SizeOfStackReserve;         <span class="hljs-comment">// 最大栈大小。CPU的堆栈。默认是1MB。-&gt; 00 10 00 00</span><br>        DWORD   SizeOfStackCommit;          <span class="hljs-comment">// 初始提交的堆栈大小。默认是4KB -&gt; 00 00 10 00</span><br>        DWORD   SizeOfHeapReserve;          <span class="hljs-comment">// 最大堆大小。编译器分配的。默认是1MB -&gt;00 10 00 00</span><br>        DWORD   SizeOfHeapCommit;           <span class="hljs-comment">// 初始提交的局部堆空间大小。默认是4K -&gt;00 00 10 00</span><br>        DWORD   LoaderFlags;                <span class="hljs-comment">// 保留，必须为0 -&gt; 00 00 00 00</span><br><br>        DWORD   NumberOfRvaAndSizes;       '<span class="hljs-comment">// 指定DataDirectory的数组个数，由于以前发行的Windows NT的原因，它只能为16。 -&gt; 00 00 00 10'</span><br>        IMAGE_DATA_DIRECTORY DataDirectory[IMAGE_NUMBEROF_DIRECTORY_ENTRIES]; '<span class="hljs-comment">// 数据目录数组。详见下文。' </span><br>    &#125; IMAGE_OPTIONAL_HEADER32, *PIMAGE_OPTIONAL_HEADER32;<br><br>typedef <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">_IMAGE_DATA_DIRECTORY</span></span> &#123;  <br>    DWORD   VirtualAddress;  <br>    DWORD   Size;  <br>&#125; IMAGE_DATA_DIRECTORY, *PIMAGE_DATA_DIRECTORY;<br><br>DataDirectory[] 数据目录数组：数组每项都有被定义的值，不同项对应不同数据结构。重点关注的IMPORT和EXPORT，它们是PE头中的非常重要的部分，其它部分不怎么重要，大致了解下即可<br></code></pre></td></tr></table></figure>
<figure class="highlight csharp"><table><tr><td class="code"><pre><code class="hljs csharp"><span class="hljs-string">'#define IMAGE_DIRECTORY_ENTRY_EXPORT          0   // Export Directory '</span><br><span class="hljs-string">'#define IMAGE_DIRECTORY_ENTRY_IMPORT          1   // Import Directory '</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> IMAGE_DIRECTORY_ENTRY_RESOURCE        2   // Resource Directory </span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> IMAGE_DIRECTORY_ENTRY_EXCEPTION       3   // Exception Directory </span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> IMAGE_DIRECTORY_ENTRY_SECURITY        4   // Security Directory </span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> IMAGE_DIRECTORY_ENTRY_BASERELOC       5   // Base Relocation Table </span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> IMAGE_DIRECTORY_ENTRY_DEBUG           6   // Debug Directory </span><br><span class="hljs-comment">//      IMAGE_DIRECTORY_ENTRY_COPYRIGHT       7   // (X86 usage) </span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> IMAGE_DIRECTORY_ENTRY_ARCHITECTURE    7   // Architecture Specific Data </span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> IMAGE_DIRECTORY_ENTRY_GLOBALPTR       8   // RVA of GP </span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> IMAGE_DIRECTORY_ENTRY_TLS             9   // TLS Directory </span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> IMAGE_DIRECTORY_ENTRY_LOAD_CONFIG    10   // Load Configuration Directory </span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> IMAGE_DIRECTORY_ENTRY_BOUND_IMPORT   11   // Bound Import Directory in headers </span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> IMAGE_DIRECTORY_ENTRY_IAT            12   // Import Address Table </span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> IMAGE_DIRECTORY_ENTRY_DELAY_IMPORT   13   // Delay Load Import Descriptors </span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> IMAGE_DIRECTORY_ENTRY_COM_DESCRIPTOR 14   // COM Runtime descriptor</span><br></code></pre></td></tr></table></figure>
<h5 id="dos存根00000040-000000bf共128字节"><a class="markdownIt-Anchor" href="#dos存根00000040-000000bf共128字节"></a> DOS存根（00000040 - 000000BF，共128字节）</h5>
<p>DOS存根则是一段简单的DOS程序，主要用来输出类似“This program cannot be run in DOS mode.”的提示语句。即使没有DOS存根，程序也能正常执行。<a href="https://links.jianshu.com/go?to=https%3A%2F%2Fblog.csdn.net%2Fsong_10%2Farticle%2Fdetails%2F84036010" target="_blank" rel="noopener">参考：DOS存根写入数据的想法</a></p>
<h5 id="特征码免杀"><a class="markdownIt-Anchor" href="#特征码免杀"></a> 特征码免杀</h5>
<p>可以使用工具进行分片，填充进行分割，然后使用杀软进行扫描删除文件的位置，特征码最先出现在什么位置；之后修改所有出现的定位特征码，后进行查杀可以发现，软件不被查杀了；古老的定位软件：MyCCL</p>
</div><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">z3lce</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://www.infore.top/2020/07/27/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/">http://www.infore.top/2020/07/27/计算机基础/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://www.infore.top" target="_blank">z3lce学习记录</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/basic/">basic</a><a class="post-meta__tags" href="/tags/PE/">PE</a></div><div class="post_share"><div class="social-share" data-image="https://pdc246871-1302651496.cos.ap-nanjing.myqcloud.com/20200719093802.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css"/><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js"></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2020/09/11/SMC%E4%BB%8B%E7%BB%8D/"><img class="prev-cover" data-src="https://pdc246871-1302651496.cos.ap-nanjing.myqcloud.com/20200719093454.png" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">SMC介绍</div></div></a></div><div class="next-post pull-right"><a href="/2020/07/27/%E9%80%86%E5%90%91%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/"><img class="next-cover" data-src="https://pdc246871-1302651496.cos.ap-nanjing.myqcloud.com/20200719093603.png" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">逆向基础知识</div></div></a></div></nav><div class="relatedPosts"><div class="relatedPosts_headline"><i class="fas fa-thumbs-up fa-fw"></i><span> 相关推荐</span></div><div class="relatedPosts_list"><div class="relatedPosts_item"><a href="/2020/09/11/SMC介绍/" title="SMC介绍"><img class="relatedPosts_cover" data-src="https://pdc246871-1302651496.cos.ap-nanjing.myqcloud.com/20200719093454.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fas fa-history fa-fw"></i> 2020-09-11</div><div class="relatedPosts_title">SMC介绍</div></div></a></div><div class="relatedPosts_item"><a href="/2020/07/15/pwn/" title="pwn"><img class="relatedPosts_cover" data-src="https://pdc246871-1302651496.cos.ap-nanjing.myqcloud.com/20200719092909.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fas fa-history fa-fw"></i> 2020-07-15</div><div class="relatedPosts_title">pwn</div></div></a></div><div class="relatedPosts_item"><a href="/2020/07/20/web学习笔记/" title="web学习笔记"><img class="relatedPosts_cover" data-src="https://pdc246871-1302651496.cos.ap-nanjing.myqcloud.com/20200719093024.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fas fa-history fa-fw"></i> 2020-07-20</div><div class="relatedPosts_title">web学习笔记</div></div></a></div><div class="relatedPosts_item"><a href="/2020/07/27/逆向基础知识/" title="逆向基础知识"><img class="relatedPosts_cover" data-src="https://pdc246871-1302651496.cos.ap-nanjing.myqcloud.com/20200719093603.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fas fa-history fa-fw"></i> 2020-07-27</div><div class="relatedPosts_title">逆向基础知识</div></div></a></div></div></div></article></main><footer id="footer" data-type="color"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2021 By z3lce</div><div class="framework-info"><span>驱动 </span><a href="https://hexo.io" target="_blank" rel="noopener"><span>Hexo</span></a><span class="footer-separator">|</span><span>主题 </span><a href="https://github.com/jerryc127/hexo-theme-butterfly" target="_blank" rel="noopener"><span>Butterfly</span></a></div></div></footer></div><section class="rightside" id="rightside"><div id="rightside-config-hide"><button id="readmode" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="font_plus" title="放大字体"><i class="fas fa-plus"></i></button><button id="font_minus" title="缩小字体"><i class="fas fa-minus"></i></button><button class="translate_chn_to_cht" id="translateLink" title="简繁转换">繁</button><button id="darkmode" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button></div><div id="rightside-config-show"><button id="rightside_config" title="设置"><i class="fas fa-cog"></i></button><button class="close" id="mobile-toc-button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></section><div class="search-dialog" id="local-search"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div></div><hr/><div id="local-search-results"><div id="local-hits"></div><div id="local-stats"><div class="local-search-stats__hr" id="hr"><span>由</span> <a href="https://github.com/wzpan/hexo-generator-search" target="_blank" rel="noopener" style="color:#49B1F5;">hexo-generator-search</a>
 <span>提供支持</span></div></div></div><span class="search-close-button"><i class="fas fa-times"></i></span></div><div class="search-mask"></div><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script src="/js/third-party/fireworks.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><script defer id="ribbon" src="/js/third-party/canvas-ribbon.js" size="150" alpha="0.6" zIndex="-1" mobile="true" data-click="true"></script><script id="ribbon_piao" mobile="true" src="/js/third-party/piao.js"></script><script src="/js/third-party/activate-power-mode.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = true;
document.body.addEventListener('input', POWERMODE);
</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module" defer></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js" async></script><script src="/js/search/local-search.js"></script><script>var endLoading = function () {
  document.body.style.overflow = 'auto';
  document.getElementById('loading-box').classList.add("loaded")
}
window.addEventListener('load',endLoading)</script></body></html>